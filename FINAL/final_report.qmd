---
title: "Python Final Report"
date: last-modified
author: "Hayden Coke and Bekah Peterson"
format:
  html:
    embed-resources: true
execute: 
  echo: false
jupyter: python3
---

feedback from presentation:
Showing multiple time series plots as a single group of scatter plot points doesn't really make sense. A line graph would have been more appropriate.

Even though there were a lot of unanswered questions, just saying there could be unknown reasons without offering any speculation is unsatisfying. What additional info would you need to answer those questions? Where would be the first places you could look?


# Patterns in Healthcare Spending from 1980 to 2014

## Introduction / Background

Healthcare spending is a growing concern for most Americans. The US spends more than twice as much per capita on health care as other developed countries (Pahlka, [Re]Coding America, p. 4). One in ten Americans has at least $250 in medical debt. The majority of Americans with $10,000 or more in debt do not think they will ever be able to pay it off. Families of middle or lower economic status are especially burdened by medical debt. (https://pmc.ncbi.nlm.nih.gov/articles/PMC11918610/)

This report will seek to answer the question: How has healthcare spending by state and region changed over time? 


## Methods

To answer this question, we examined a dataset of healthcare spending from 1980 to 2014, which reported individual state spending and spending by item category. Dr. Gore provided us with a census dataset which we used to match states and years to their corresponding populations. To account for inflation, we adjusted the spending amounts in the original dataset using the python package Cpi by Palewire, which uses the Consumer Price Index. After adjusting for inflation, we calculated spending per capita by dividing the spending by the state population. 

Healthcare items reported by this dataset include: Hospital Care; Physician & Clinical Services; Other Professional Services; Dental Services; Home Health Care; Prescription Drugs; Durable Medical Products; Other Non-durable Medical Products; Nursing Home Care; and Other Health, Residential, and Personal Care. By the definition on the CDC website, Personal Healthcare Spending is all healthcare spending categories combined. 

## Results



## Conclusion

In our exploration of the spending patterns we found that healthcare spending is increasing at a rate that outpaces inflation. The District of Columbia is an outlier for high spending, largely due to their very high hospital care costs. More research and analysis is needed to explain why DC hospitals are so much more expensive than in other states. DC is the most expensive "state" to live in, but that does not fully explain why hospital care in particular is more expensive. It's possible that they have care laws that are causing an increase in price, such as serving patients without insurance or requing expensive tests for patients that are not required in other states. 

Thirty four states have experienced a cost percent change of more than 200% between 1980 and 2014. New Hampshire and Vermont have experienced a percent change of more than 300%. There is some regional connection among the states with the greatest or least percent changes. Among the 5 states that experienced the greatest increase, 3 are in New England. Among the 5 states that expereienced the least increase, 3 are in the Southwest. It's possible that there is a climate connection, but a political connection is more likely. Data on healthcare policies and laws would be needed to identify any connections. 

This data set does not include any information from the last 11 years, we know that health care spending continued to increase, especially after COVID-19. Further research could explore how spending has changed since 2020, identifying where costs are increasing fastest, both by region and category. 


## References

https://palewi.re/docs/cpi/#id6

https://www.bls.gov/cpi/


## Appendix

```{python}
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import PredictionErrorDisplay
from scipy.stats import probplot
from statsmodels.stats.outliers_influence import variance_inflation_factor

df_all = pd.read_csv("./datasets/healthcare_spending_states.csv")
df_personal = df_all[df_all['Item'] == 'Personal Health Care (Millions of Dollars)']
df_items = df_all[df_all['Item'] != 'Personal Health Care (Millions of Dollars)']
```

```{python}
# spending by item over time
sns.lineplot(df_items, x='Year', y='SpendAdjust', hue='Item')
plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0)
plt.xlabel("Year")
plt.ylabel("Millions of Dollars")
# plt.title("Spending by Item in Millions of Dollars (1980-2014)")
plt.show()
```

**Fig 1.** Spending in Millions of Dollars by Item (1980-2014). 

```{python}
# spending per capita by region (exluding DC)
df_personal_noDC = df_personal[df_personal['State'] != 'District of Columbia']
sns.lineplot(df_personal_noDC, x = 'Year', y = 'perCapSpendAdjusted', hue='Region_Name')
plt.xlabel("Year")
plt.ylabel("Spending per Capita in Millions of Dollars")
plt.show()
```

**Fig 2.** Spending per Capita in Millions of Dollars by Region, DC excluded (1980-2014). 


```{python}
df_2014 = df_personal[df_personal['Year'] == 2014]
df_1980 = df_personal[df_personal['Year'] == 1980]

spending_2014 = df_2014.groupby('State', as_index=False)['perCapSpendAdjusted'].sum()
spending_2014.rename(columns={'perCapSpendAdjusted': 'Spending Per Capita in 2014'}, inplace=True)

spending_1980 = df_1980.groupby('State', as_index=False)['perCapSpendAdjusted'].sum()
spending_1980.rename(columns={'perCapSpendAdjusted': 'Spending Per Capita in 1980'}, inplace=True)

delta = spending_1980.merge(spending_2014, on='State', how='left')
delta['Percent Change'] = (delta['Spending Per Capita in 2014'] - delta['Spending Per Capita in 1980']) / delta['Spending Per Capita in 1980'] * 100

delta.sort_values(by='Percent Change', inplace=True, ascending=False, ignore_index=True)

delta

```

**Table 1.** Percent growth on healthcare spending (measured in millions of dollars per capita) among states from 1980 to 2014. 






```{python}
sns.lmplot(df_personal, x = 'Year', y = 'perCapSpendAdjusted', hue='Region_Name')
plt.show()

x = df_personal['Year'].values.reshape((-1, 1))
y = df_personal['perCapSpendAdjusted']
reg = LinearRegression().fit(x, y)

print("score:", reg.score(x, y))
print("coef:", reg.coef_)
print("intercept:", reg.intercept_)
```

```{python}
# How much do individual states differ from the national average?

# national average for spending per capita on all items across time
cap_avgs = df_personal.groupby('Year', as_index=False)['perCapSpendAdjusted'].mean()

sns.lmplot(cap_avgs, x='Year', y='perCapSpendAdjusted')
plt.ylim(0,0.02)
plt.show()

dc_only = df_personal[df_personal['State'] == 'District of Columbia']

# which state is the highest above average?
sns.lmplot(dc_only, x='Year', y='perCapSpendAdjusted')
plt.ylim(0,0.02)
plt.show()
```

```{python}
states = ['Alabama','Alaska','Arizona','Arkansas',
          'California','Colorado','Connecticut','Delaware',
          'District of Columbia','Florida','Georgia','Hawaii',
          'Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky',
          'Louisiana','Maine','Maryland','Massachusetts','Michigan',
          'Minnesota','Mississippi','Missouri','Montana','Nebraska',
          'Nevada','New Hampshire','New Jersey','New Mexico',
          'New York','North Carolina','North Dakota','Ohio',
          'Oklahoma','Oregon','Pennsylvania','Rhode Island',
          'South Carolina','South Dakota','Tennessee','Texas',
          'Utah','Vermont','Virginia','Washington','West Virginia',
          'Wisconsin','Wyoming']

results = []

for state in states:
  df_state = df_personal[df_personal['State'] == state]

  x = df_state['Year'].values.reshape((-1, 1))
  y = df_state['perCapSpendAdjusted']

  state_model = LinearRegression().fit(x, y)
  print("score:", state_model.score(x, y))
  print("coef:", state_model.coef_)
  print("intercept:", state_model.intercept_)

  results.append([state, state_model.score(x, y), state_model.coef_])

results_df = pd.DataFrame(results, columns = ['State', 'Score', 'Coef'])

results_df.sort_values(by='Coef', ascending=False, inplace=True)

```
