---
title: "Python Final Report"
date: last-modified
author: "Hayden Coke and Bekah Peterson"
format:
  html:
    embed-resources: true
execute: 
  echo: false
jupyter: python3
---

feedback from presentation:
Showing multiple time series plots as a single group of scatter plot points doesn't really make sense. A line graph would have been more appropriate.

The slope coefficients seem like they would be sensitive to the absolute value of the variable. I think it would be more correct for it to be normalized based on percent / proportion.

Axes labels were not super clear (should say millions of dollars per person per capita)

Even though there were a lot of unanswered questions, just saying there could be unknown reasons without offering any speculation is unsatisfying. What additional info would you need to answer those questions? Where would be the first places you could look?


# Patterns in Healthcare Spending from 1980 to 2014

## Introduction / Background

Healthcare spending is a growing concern for most Americans. The US spends more than twice as much per capita on health care as other developed countries (Pahlka, [Re]Coding America, p. 4). One in ten Americans has at least $250 in medical debt. The majority of Americans with $10,000 or more in debt do not think they will ever be able to pay it off. Families of middle or lower economic status are especially burdened by medical debt. (https://pmc.ncbi.nlm.nih.gov/articles/PMC11918610/)

This report will seek to answer the question: How has the pattern of healthcare spending by state  changed over time? 



## Methods

The dataset that we looked at is medical spending from 1980-2014. The data was further broken down into individual state spending and spending by item category. To better compare states, spending was divided by population to find the per capita spending. The population dataset was given to us by Dr. Gore and encompasses the range of time in our original dataset. We also adjusted our data for inflation to better compare across time using the consumer price index. 


## Results



## Conclusion

## References

## Appendix

```{python}
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import cpi 
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import PredictionErrorDisplay
from scipy.stats import probplot
from statsmodels.stats.outliers_influence import variance_inflation_factor

df_states = pd.read_csv("./datasets/healthcare_spending_states.csv")
```

```{python}
# spending by item over time
sns.lineplot(df_states, x='Year', y='perCapSpendAdjusted', hue='Item')
plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0)
plt.xlabel("Year")
plt.ylabel("Millions of Dollars Per Person Per Capita")
plt.title("")
plt.show()
```


```{python}
# How has healthcare spending per capita changed from 1980-2014?
sns.lmplot(df_states, x = 'Year', y = 'perCapSpendAdjusted')
plt.show()

x = df_states['Year'].values.reshape((-1, 1))
y = df_states['perCapSpendAdjusted']
reg = LinearRegression().fit(x, y)

print("score:", reg.score(x, y))
print("coef:", reg.coef_)
print("intercept:", reg.intercept_)
```


```{python}
# How much do individual states differ from the national average?

# national average for spending per capita on all items across time
cap_avgs = df_states.groupby('Year', as_index=False)['perCapSpendAdjusted'].mean()

sns.lmplot(cap_avgs, x='Year', y='perCapSpendAdjusted')
plt.ylim(0,0.02)
plt.show()

dc_only = df_states[df_states['State'] == 'District of Columbia']

# which state is the highest above average?
sns.lmplot(dc_only, x='Year', y='perCapSpendAdjusted')
plt.ylim(0,0.02)
plt.show()
```

```{python}
states = ['Alabama','Alaska','Arizona','Arkansas',
          'California','Colorado','Connecticut','Delaware',
          'District of Columbia','Florida','Georgia','Hawaii',
          'Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky',
          'Louisiana','Maine','Maryland','Massachusetts','Michigan',
          'Minnesota','Mississippi','Missouri','Montana','Nebraska',
          'Nevada','New Hampshire','New Jersey','New Mexico',
          'New York','North Carolina','North Dakota','Ohio',
          'Oklahoma','Oregon','Pennsylvania','Rhode Island',
          'South Carolina','South Dakota','Tennessee','Texas',
          'Utah','Vermont','Virginia','Washington','West Virginia',
          'Wisconsin','Wyoming']

results = []

for state in states:
  df_state = df_states[df_states['State'] == state]

  x = df_state['Year'].values.reshape((-1, 1))
  y = df_state['perCapSpendAdjusted']

  state_model = LinearRegression().fit(x, y)
  print("score:", state_model.score(x, y))
  print("coef:", state_model.coef_)
  print("intercept:", state_model.intercept_)

  results.append([state, state_model.score(x, y), state_model.coef_])

results_df = pd.DataFrame(results, columns = ['State', 'Score', 'Coef'])

results_df.sort_values(by='Coef', ascending=False, inplace=True)

```
